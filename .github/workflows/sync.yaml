name: Copy Files
on: [workflow_dispatch]
jobs:
  copy-files:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout template
      uses: actions/checkout@v3
      with:
        repository: kudrinyaroslav/template
        ref: main
        fetch-depth: 0
        path: ./template
        
    - name: Checkout child
      uses: actions/checkout@v3
      with:
        repository: kudrinyaroslav/child
        fetch-depth: 0
        path: ./child
        
    - name: Check if branch exists
      run: |
        cd child
        if git branch -a | grep "origin/new-branch-name"; then
         git push origin --delete new-branch-name
        fi

    - name: Copy files to child
      run: |
       cp -r ./template/* ./child/
       ls ./child
       cd child
       git branch
       
    - name: Commit changes
      run: |
          cd child
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git checkout -b new-branch-name
          git add .
          git commit -m "Copy files from template to child"
          ls
          git push --set-upstream origin new-branch-name
    - name: Commit changes
      run: |
          curl -s -X POST -H "Authorization: token ${{secrets.GITHUB_TOKEN}}" -H "Accept: application/vnd.github+json" "https://api.github.com/repos/kudrinyaroslav/child/pulls" -d '{"head":"new-branch-name","base":"main","title":"Update from template repository"}'
